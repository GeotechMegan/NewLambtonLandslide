<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Mapped Evidence</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    crossorigin=""
  />

  <style>
    html, body {
      height: 100%;
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
    }

    h1 {
      text-align: center;
      margin: 20px 0;
      font-weight: normal;
    }

    nav {
      display: flex;
      justify-content: space-between;
      max-width: 1400px;
      padding: 0 20px;
      margin: 0 auto 20px auto;
    }

    nav a {
      text-decoration: none;
      color: #000;
      font-size: 1.1rem;
    }

    .intro {
      max-width: 1400px;
      padding: 0 20px;
      margin: 0 auto 20px auto;
      font-size: 0.95rem;
    }

    /* map + layers layout */
    .map-layout {
  display: flex;
  height: 65vh;
  min-height: 520px;
  max-width: 1400px;   /* controls left/right margin */
  padding: 0 20px;
  margin: 0 auto;      /* centres the whole map block */
}


    #map {
      flex: 1;
      height: 100%;
      background: #e0e0e0;
    }

    .layers {
      width: 260px;
      border-left: 1px solid #ccc;
      padding: 10px;
      overflow-y: auto;
    }
    .layers details {
  margin-bottom: 10px;
}

.layers summary {
  font-weight: bold;
  cursor: pointer;
  margin-bottom: 6px;
}

.layer-item {
  margin-left: 16px;
  margin-bottom: 6px;
  font-size: 0.9rem;
}

.layer-item label {
  cursor: pointer;
}

.layer-row {
  display: flex;
  align-items: center;
  gap: 6px;
}

.layer-row label {
  flex: 1; /* pushes the button to the right */
}

.layer-item input[type="range"] {
  width: 100%;
  margin-top: 4px;
}

.layer-note {
  font-size: 0.8rem;   /* adjust as needed */
  color: #555;         /* optional: de-emphasise */
  margin-left: 16px;   /* aligns with layer items */
  margin-top: 4px;
}

 /* Tooltip scrolling */
.leaflet-tooltip.article-preview {
  max-height: min(60vh, 520px);
  overflow-y: auto;
  overflow-x: hidden;
  padding: 8px;
}

/* Make the image responsive inside the tooltip */
.leaflet-tooltip.article-preview img {
  max-width: 100%;
  height: auto;
  display: block;
}

/* Hover-preview popup: scrollable and clickable */
.article-preview-popup .leaflet-popup-content {
  width: 280px;          /* tweak */
  max-height: 60vh;      /* prevents running off-screen */
  overflow: auto;        /* enables scrolling */
  margin: 10px;
}

.article-preview-popup img {
  width: 100%;
  height: auto;
  display: block;
  border: 1px solid #ccc;
}

    
  </style>
</head>

<body>

  <h1>New Lambton Landslide</h1>

  <nav>
    <a href="Home.html">Home</a>
    <a href="Mapped_Evidence.html">Mapped Evidence</a>
    <a href="Files_Sources.html">Files and Sources</a>
    <a href="Contact_About.html">Contact and About</a>
    <a href="Forum.html">Forum</a>
  </nav>

  <div class="intro">
    <p>Take a journey through time and space in the understanding of slope instability in Newcastle, NSW, & geologically-relevant surrounds. This is an evolving curation of everything possible testifying to prevalence, awareness, mechanisms, outcomes, responsibilities and more, when it comes to Newcastle-relevant slope instability issues.</p>
    </div>

  <div style="max-width:1500px;margin:0 auto 12px auto;text-align:left;">
  <button
    id="back-to-new-lambton"
    type="button"
    style="
      padding:8px 14px;
      border:1px solid #000;
      background:#fff;
      color:#000;
      cursor:pointer;
      font-size:0.95rem;
    "
  >
    Back to New Lambton
  </button>
</div>


  <div class="map-layout">
    <div id="map">
  </div>
    
  <div class="layers">

    <details>
  <summary>Geology etc.</summary>

  <!-- NSW 5m Hillshade -->
  <div class="layer-item">
    <div class="layer-row">
      <input type="checkbox" id="layer-geology-hillshade">
      <label for="layer-geology-hillshade">NSW 5m Hillshade</label>
      <button type="button" id="zoom-geology-hillshade">Zoom to</button>
    </div>
    <input
      type="range"
      id="opacity-geology-hillshade"
      min="0"
      max="1"
      step="0.05"
      value="0.7"
    >
  </div>

  <!-- Simplified Regional Geology -->
  <div class="layer-item">
    <div class="layer-row">
      <input type="checkbox" id="layer-geology-regional">
      <label for="layer-geology-regional">Simplified Regional Geology</label>
      <button type="button" id="zoom-geology-regional">Zoom to</button>
    </div>
    <input
      type="range"
      id="opacity-geology-regional"
      min="0"
      max="1"
      step="0.05"
      value="0.7"
    >
    <div style="margin-top:6px;">
      <button type="button" id="download-geology-legend">Download Geology Legend</button>
    </div>
  </div>

</details>


<details>
  <summary>1913</summary>

  <div class="layer-item">
    <div class="layer-row">
      <input type="checkbox" id="layer-1913-subdivision-ad">
      <label for="layer-1913-subdivision-ad">Subdivision advertisement, 1913 (exact date unknown)</label>
      <button type="button" id="zoom-1913-subdivision-ad">Zoom to</button>
    </div>
    <input
      type="range"
      id="opacity-1913-subdivision-ad"
      min="0"
      max="1"
      step="0.05"
      value="0.7"
    >
  </div>
  
</details>

    
<details>
    <summary>1917</summary>
  
    <div class="layer-item">
      <input type="checkbox" id="layer-1917-title">
      <label for="layer-1917-title">Certificate of Title – 119 Victoria Rd</label>
    </div>
   <div class="layer-item">
  <div class="layer-row">
    <input type="checkbox" id="layer-1917-waterboard">
    <label for="layer-1917-waterboard">Water Board Survey Map</label>
    <button type="button" id="zoom-1917-waterboard">Zoom to</button>
  </div>
  <input
    type="range"
    id="opacity-1917-waterboard"
    min="0"
    max="1"
    step="0.05"
    value="0.7"
  >
</div>
  
</details>

    
<details>
  <summary>1936</summary>
  
  <div class="layer-item">
    <div class="layer-row">
      <input type="checkbox" id="layer-1936-parish">
      <label for="layer-1936-parish">1936 Newcastle Parish Map</label>
      <button type="button" id="zoom-1936-parish">Zoom to</button>
    </div>
    <input
      type="range"
      id="opacity-1936-parish"
      min="0"
      max="1"
      step="0.05"
      value="0.7"
    >
  </div>
  <div class="layer-note">(Note that the Slip Creek is marked out the same as all the other creeks in the Parish)</div>

</details>

    
<details>
  <summary>1944</summary>
  
  <div class="layer-item">
    <div class="layer-row">
      <input type="checkbox" id="layer-1944">
      <label for="layer-1944">1944 Aerial Photography</label>
      <button type="button" id="zoom-1944">Zoom to</button>
    </div>
    <input
      type="range"
      id="opacity-1944"
      min="0"
      max="1"
      step="0.05"
      value="0.7"
    >
  </div>
  <div class="layer-note">(Note the bridge over the creek at the end of Portland Pl)</div>
</details>

<details>
  <summary>1949</summary>
  
  <div class="layer-item">
    <div class="layer-row">
    <input type="checkbox" id="layer-1949-families-move-out-of-creep-damaged-flats">
    <label for="layer-1949-families-move-out-of-creep-damaged-flats">Newspaper article titled "Families Move Out of Creep-Damaged Flats", 21st of June, 1949</label>
      <button type="button" id="zoom-1949-families-move-out-of-creep-damaged-flats">Zoom to</button>
  </div>
  </div>
  <div class="layer-note">The article mentions 3 falls of ground: one at Apsley Court (see marker with photo), one at Church St (marked within this layer) and one at King Edward Park.</div>

    <div class="layer-item">
    <div class="layer-row">
      <input type="checkbox" id="layer-1949-landslide-endangers-flats">
      <label for="layer-1949-landslide-endangers-flats">Newspaper image: "Landslide Endangers Flats" (21st Jun 1949)</label>
      <button type="button" id="zoom-1949-landslide-endangers-flats">Zoom to</button>
    </div>
  </div>

  <div class="layer-item">
  <div class="layer-row">
    <input type="checkbox" id="layer-1949-boolaroo-scarps">
    <label for="layer-1949-boolaroo-scarps">Photo: Boolaroo landslide scarps, 1st Sep 1949</label>
    <button type="button" id="zoom-1949-boolaroo-scarps">Zoom to</button>
  </div>
</div>
<div class="layer-note">
  Image shows tension cracks in the foreground, a new scarp in mid-ground, old scarp below that and the main scarp in the background.
</div>

  
  <div class="layer-item">
  <div class="layer-row">
    <input type="checkbox" id="layer-2thirdst-damage">
    <label for="layer-2thirdst-damage">
      Photo: Damage to house & fence at 2 Third St, Boolaroo, 1st of Sep . Landslide flow visible from background to in front of house.
    </label>
    <button type="button" id="zoom-2thirdst-damage">Zoom to</button>
  </div>
</div>


  <div class="layer-item">
    <div class="layer-row">
      <input type="checkbox" id="layer-1949-threat-to-boolaroo">
      <label for="layer-1949-threat-to-boolaroo">Newspaper article: "Threat to Boolaroo", The Inverell Times, pg1, 2 Sep </label>
      <button type="button" id="zoom-1949-threat-to-boolaroo">Zoom to</button>
    </div>
  </div>
  <div class="layer-note">Article mentions that movement had been worsening since June.</div>

  <div class="layer-item">
    <div class="layer-row">
      <input type="checkbox" id="layer-1949-creep-threat-at-boolaroo">
<label for="layer-1949-creep-threat-at-boolaroo">Newspaper article: "”Creep” Threat At Boolaroo", the Newcastle Morning Herald and Miners’ Advocate, pg 1, 2 Sep 1949</label>
<button type="button" id="zoom-1949-creep-threat-at-boolaroo">Zoom to</button>
    </div>
  </div>
<div class="layer-note">Reports that landslides were not uncommon in the hills.</div>

  
</details>
    
<details>
  <summary>1950</summary>
  <div class="layer-item">
    <div class="layer-row">
    <input type="checkbox" id="layer-1950-addison-boy-walking">
    <label for="layer-1950-addison-boy-walking">Boy walking west near Addison Rd landslide, 21 April 1950</label>
    <button type="button" id="zoom-1950-addison-boy-walking">Zoom to</button>
  </div>
  </div>

    <div class="layer-item">
    <div class="layer-row">
      <input type="checkbox" id="layer-1950-addison-28-30-32">
      <label for="layer-1950-addison-28-30-32">Woman in car looking at The Slip, with 28, 30 & 32 Addison Rd in mid-ground. (21 Apr 1950)</label>
      <button type="button" id="zoom-1950-addison-28-30-32">Zoom to</button>
    </div>
  </div>

  <div class="layer-item">
    <div class="layer-row">
      <input type="checkbox" id="layer-1950-this-road-is-bad">
      <label for="layer-1950-this-road-is-bad">Newspaper article titled "This Road Is Bad", the Newcastle Morning Herald and Miners’ Advocate, pg 3, 21st April 1950</label>
      <button type="button" id="zoom-1950-this-road-is-bad">Zoom to</button>
    </div>
  </div>
<div class="layer-note">Article discusses the ongoing issues with Addison Road</div>

  <div class="layer-item">
    <div class="layer-row">
      <input type="checkbox" id="layer-1950-creep-in-new-lambton-yard">
      <label for="layer-1950-creep-in-new-lambton-yard">Newspaper article, "CREEP" IN NEW LAMBTON YARD, the Newcastle Morning Herald and Miners’ Advocate, pg 2, 23rd of June 1950</label>
      <button type="button" id="zoom-1950-creep-in-new-lambton-yard">Zoom to</button>
    </div>
  </div>
<div class="layer-note">Article describes extensive "subsidence". Note that causes of subsidence are not always anthropogenic.</div>
  <div class="layer-note">Mr Chalker lived at 17 Addison Rd & Mr Collins at number 15 (vol-fols 5771-114/115)</div>


<div class="layer-item">
    <div class="layer-row">
      <input type="checkbox" id="layer-1950-landslide-at-lake">
      <label for="layer-1950-landslide-at-lake">Newspaper article: "Landslide At Lake / HOMES DAMAGED BY LANDSLIDE", the Newcastle Morning Herald and Miners’ Advocate, pg 1, 18th of July 1950</label>
      <button type="button" id="zoom-1950-landslide-at-lake">Zoom to</button>
    </div>
  </div>
<div class="layer-note">Precise location undetermined</div>

 <div class="layer-item">
  <div class="layer-row">
    <input type="checkbox" id="layer-1950-letter-c-g-millington-12thOct">
    <label for="layer-1950-letter-c-g-millington-12thOct">
      C. G. Millington making sense in Letters to the Editor, 12th Oct 1950. 
    </label>
    <button type="button" id="zoom-1950-letter-c-g-millington-12thOct">Zoom to</button>
  </div>
</div>
  
  <div class="layer-item">
  <div class="layer-row">
    <input type="checkbox" id="layer-1950-letter-isaac-hoare">
    <label for="layer-1950-letter-isaac-hoare">
      Letter to the editor, from Isaac Hoare, 14th Oct 1950. Mentions another area nearby “which has also suffered”. Exact location unknown.
    </label>
    <button type="button" id="zoom-1950-letter-isaac-hoare">Zoom to</button>
  </div>
</div>

  
</details>


<details>
  
  <summary>1951</summary>
  <div class="layer-item">
    <div class="layer-row">
      <input type="checkbox" id="layer-1951-road-collapses">
      <label for="layer-1951-road-collapses">"Road collapses" from Newcastle Morning Herald and Miners' Advocate, 17 Jan 1951</label>
      <button type="button" id="zoom-1951-road-collapses">Zoom to</button>
    </div>
  </div>

  <div class="layer-item">
  <div class="layer-row">
    <input type="checkbox" id="layer-1951-chelston-st">
    <label for="layer-1951-chelston-st">
      Photo: Mr & Mrs Howell's house. 19th Jan 1951 Chelston St Landslide.
    </label>
    <button type="button" id="zoom-1951-chelston-st">Zoom to</button>
  </div>
</div>
  <div class="layer-item">
  <div class="layer-row">
    <input type="checkbox" id="layer-1951-chelston-st-flowpath">
    <label for="layer-1951-chelston-st-flowpath">
      Photo: 19th Jan 1951 Chelston St Landslide.
    </label>
    <button type="button" id="zoom-1951-chelston-st-flowpath">Zoom to</button>
  </div>
</div>

</details>
    

<details>
  <summary>1953</summary>
  
  <div class="layer-item">
    <div class="layer-row">
      <input type="checkbox" id="layer-1953-addison-facing-w">
      <label for="layer-1953-addison-facing-w">"The Slip" moved again. Photo, 22 Mar 1953</label>
      <button type="button" id="zoom-1953-addison-facing-w">Zoom to</button>
    </div>
  </div>

   <div class="layer-item">
    <div class="layer-row">
      <input type="checkbox" id="layer-1953-addison-men-and-children">
      <label for="layer-1953-addison-men-and-children">Photo: Men & children surveying renewed movement in "The Slip". 22 Mar 1953</label>
      <button type="button" id="zoom-1953-addison-men-and-children">Zoom to</button>
    </div>
  </div>
  
<div class="layer-item">
    <div class="layer-row">
      <input type="checkbox" id="layer-1953-addison-residents-surveying-movement">
      <label for="layer-1953-addison-residents-surveying-movement">Photo: "The Slip", 22nd March, 1953.</label>
      <button type="button" id="zoom-1953-addison-residents-surveying-movement">Zoom to</button>
    </div>
  </div>
      
</details>


<details>
  <summary>1954</summary>
  
  <div class="layer-item">
    <div class="layer-row">
      <input type="checkbox" id="layer-1954-imagery">
      <label for="layer-1954-imagery">1954 Aerial Photography</label>
      <button type="button" id="zoom-1954-imagery">Zoom to</button>
    </div>
    <input
      type="range"
      id="opacity-1954-imagery"
      min="0"
      max="1"
      step="0.05"
      value="0.7"
    >
  </div>
  
</details>


<details>
  <summary>1957</summary>

  <div class="layer-item">
    <div class="layer-row">
      <input type="checkbox" id="layer-1957-council-acquisition-11-addison">
      <label for="layer-1957-council-acquisition-11-addison">
        Document: 14th Aug 1957. The Council of the City of Newcastle purchase part of 11 Addison Rd to deal with The Slip.
      </label>
      <button type="button" id="zoom-1957-council-acquisition-11-addison">Zoom to</button>
    </div>
  </div>

<div class="layer-item">
  <div class="layer-row">
    <input type="checkbox" id="layer-1957-acq-13-addison">
    <label for="layer-1957-acq-13-addison">Document: 7th Nov 1957. The Council of the City of Newcastle purchase part of 13 Addison Rd to deal with The Slip.</label>
    <button type="button" id="zoom-1957-acq-13-addison">Zoom to</button>
  </div>
   <input
    type="range"
    id="opacity-1957-acq-13-addison"
    min="0"
    max="1"
    step="0.05"
    value="1"
  >
</div>

</details>


<details>
  <summary>1958</summary>

<div class="layer-item">
  <div class="layer-row">
    <input type="checkbox" id="layer-1958-addison15-acq">
    <label for="layer-1958-addison15-acq">
      The Council of the City of Newcastle purchase part of 15 Addison Rd to deal with The Slip.
    </label>
    <button type="button" id="zoom-1958-addison15-acq">Zoom to</button>
  </div>
</div>

</details>
    
    
<details>
  <summary>1959</summary>
  <div class="layer-item">
    <div class="layer-row">
      <input type="checkbox" id="layer-1959-parish">
      <label for="layer-1959-parish">1959 Newcastle Parish Map</label>
      <button type="button" id="zoom-1959-parish">Zoom to</button>
    </div>
    <input
      type="range"
      id="opacity-1959-parish"
      min="0"
      max="1"
      step="0.05"
      value="0.7"
    >
  </div>
  <div class="layer-note">(Note again that the Slip Creek is mapped)</div>
</details>


<details>
  <summary>1966</summary>
    <div class="layer-item">
      <div class="layer-row">
        <input type="checkbox" id="layer-1966-imagery">
        <label for="layer-1966-imagery">Aerial imagery, 1966.</label>
        <button type="button" id="zoom-1966-imagery">Zoom to</button>
      </div>
      <input
        type="range"
        id="opacity-1966-imagery"
        min="0"
        max="1"
        step="0.05"
        value="0.7"
      >
    </div>
  
</details>
    
    
<details>
  <summary>1969</summary>
  <div class="layer-item">
    <div class="layer-row">
      <input type="checkbox" id="layer-1969-midwest">
      <label for="layer-1969-midwest">1969 MidWest Ward Map</label>
      <button type="button" id="zoom-1969-midwest">Zoom to</button>
    </div>
    <input
      type="range"
      id="opacity-1969-midwest"
      min="0"
      max="1"
      step="0.05"
      value="0.7"
    >
  </div>
</details>


<details>
  <summary>1983</summary>

  <div class="layer-item">
    <div class="layer-row">
      <input type="checkbox" id="layer-1983-coffey-commissioned">
      <label for="layer-1983-coffey-commissioned">
        1982 to 1983: Lake Macquarie Munincipal Council commission Coffey to do a geotechnical investigation &amp; report
      </label>
      <button type="button" id="zoom-1983-coffey-commissioned">Zoom to</button>
    </div>
  </div>

</details>


<details>
  <summary>1984</summary>

  <div class="layer-item">
  <div class="layer-row">
    <input type="checkbox" id="layer-1984-lmcc-first-geotech-zoning">
    <label for="layer-1984-lmcc-first-geotech-zoning">LMCC commission and produce their first geotechnical zoning map.</label>
    <button type="button" id="zoom-1984-lmcc-first-geotech-zoning">Zoom to</button>
  </div>
</div>

  
</details>

    
    
<details>
  <summary>1988</summary>
  
    <div class="layer-item">
  <div class="layer-row">
    <input type="checkbox" id="layer-1988-chelston-st-29apr">
    <label for="layer-1988-chelston-st-29apr">
      Photo: 29th April 1988 Chelston St Landslide.
    </label>
    <button type="button" id="zoom-1988-chelston-st-29apr">Zoom to</button>
  </div>
</div>
</details>


<details>
  <summary>2023</summary>

  <div class="layer-item">
    <div class="layer-row">
      <input type="checkbox" id="layer-2023-sat">
      <label for="layer-2023-sat">Satellite imagery, 15th of October, 2023.</label>
      <button type="button" id="zoom-2023-sat">Zoom to</button>
    </div>
    <input
      type="range"
      id="opacity-2023-sat"
      min="0"
      max="1"
      step="0.05"
      value="0.7"
    >
  </div>
</details>

    

<details>
  <summary>2025</summary>

  <div class="layer-item">
    <div class="layer-row">
      <input type="checkbox" id="layer-LakeMacLocalsFBpost23rdMay2025">
      <label for="layer-LakeMacLocalsFBpost23rdMay2025">Landslip on Munibung Hill caused power outage- FaceBook post, 23rd May 2025</label>
      <button type="button" id="zoom-LakeMacLocalsFBpost23rdMay2025">Zoom to</button>
    </div>
  </div>

<div class="layer-item">
  <div class="layer-row">
    <input type="checkbox" id="layer-2025-satellite-2025-07-20">
    <label for="layer-2025-satellite-2025-07-20">Satellite imagery, 20th July 2025</label>
    <button type="button" id="zoom-2025-satellite-2025-07-20">Zoom to</button>
  </div>
  <input
    type="range"
    id="opacity-2025-satellite-2025-07-20"
    min="0"
    max="1"
    step="0.05"
    value="0.7"
  >
</div>


</details>


</div>

  </div>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    crossorigin=""
  ></script>

  <!-- Initialise map -->
  <script>
document.addEventListener('DOMContentLoaded', () => {
  const streetMap = L.tileLayer(
  'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
  {
    attribution: '&copy; OpenStreetMap contributors',
    maxZoom: 22
  }
);

const satelliteMap = L.tileLayer(
  'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
  {
    attribution: 'Tiles © Esri',
    maxZoom: 22
  }
);

const map = L.map('map', {
  maxZoom: 22,
  layers: [streetMap]
}).setView([-32.923512, 151.708520], 15);

const baseMaps = {
  "Street map": streetMap,
  "Satellite imagery": satelliteMap
};

L.control.layers(baseMaps, null, { collapsed: false }).addTo(map);

  //back-to-New-Lambton button
document.getElementById('back-to-new-lambton').addEventListener('click', () => {
  map.setView([-32.923512, 151.708520], 16);
});
  

// 1913 Subdivision advertisement (single-image overlay)
let ad1913Overlay = null;

const checkbox1913Ad = document.getElementById('layer-1913-subdivision-ad');
const opacitySlider1913Ad = document.getElementById('opacity-1913-subdivision-ad');

const ad1913Bounds = [
  [-32.93065, 151.70470],   // south-west
  [-32.91959, 151.717122]  // north-east
];

checkbox1913Ad.addEventListener('change', () => {
  if (checkbox1913Ad.checked) {

    if (!ad1913Overlay) {
      const imageUrl = 'data/1913/M1651 - New Lambton Subdivision Plan_1913_rotated.png';

      ad1913Overlay = L.imageOverlay(imageUrl, ad1913Bounds, {
        opacity: parseFloat(opacitySlider1913Ad.value)
      });
    }

    ad1913Overlay.addTo(map);

  } else {
    if (ad1913Overlay) map.removeLayer(ad1913Overlay);
  }
});

// Opacity slider controls the image
opacitySlider1913Ad.addEventListener('input', () => {
  if (ad1913Overlay) ad1913Overlay.setOpacity(parseFloat(opacitySlider1913Ad.value));
});

// Zoom-to button
document.getElementById('zoom-1913-subdivision-ad').addEventListener('click', () => {
  if (ad1913Overlay) map.fitBounds(ad1913Overlay.getBounds());
  else map.fitBounds(ad1913Bounds);
});

  

  let waterboard1917 = null;
   const opacitySlider = document.getElementById('opacity-1917-waterboard');
   const checkbox = document.getElementById('layer-1917-waterboard');

  checkbox.addEventListener('change', () => {
    if (checkbox.checked) {
      if (!waterboard1917) {
       const imageUrl = 'data/1917/water_board_map_1917.png';

        const bounds = [
          [-32.927362, 151.702385],  // south-west
          [-32.921030, 151.712207]   // north-east
        ];

        waterboard1917 = L.imageOverlay(imageUrl, bounds, {
  opacity: parseFloat(opacitySlider.value)
});

      }

      waterboard1917.addTo(map);
    } else {
      if (waterboard1917) {
        map.removeLayer(waterboard1917);
      }
    }
  }); //This line ends the checkbox handler
    
  //This is the slider listener  
    opacitySlider.addEventListener('input', () => {
  if (waterboard1917) {
    waterboard1917.setOpacity(parseFloat(opacitySlider.value));
  }
}); //This line ends the slider listener


    document.getElementById('zoom-1917-waterboard').addEventListener('click', () => {
  if (waterboard1917) {
    map.fitBounds(waterboard1917.getBounds());
  }
});

let parish1936 = null;

const checkbox1936 = document.getElementById('layer-1936-parish');
const opacitySlider1936 = document.getElementById('opacity-1936-parish');

checkbox1936.addEventListener('change', () => {
  if (checkbox1936.checked) {
    if (!parish1936) {
      const imageUrl = 'data/1936/newcastle_parish_map_1936.png';
      
      const bounds = [
        [-32.947076, 151.663018],  // south-west
        [-32.875890, 151.755627]   // north-east
      ];

      parish1936 = L.imageOverlay(imageUrl, bounds, {
        opacity: parseFloat(opacitySlider1936.value)
      });
    }

    parish1936.addTo(map);
  } else {
    if (parish1936) map.removeLayer(parish1936);
  }
});

opacitySlider1936.addEventListener('input', () => {
  if (parish1936) parish1936.setOpacity(parseFloat(opacitySlider1936.value));
});

document.getElementById('zoom-1936-parish').addEventListener('click', () => {
  if (parish1936) map.fitBounds(parish1936.getBounds());
});

    
    // 1944 ( layer group)
let layer1944 = null;
let layer1944Bounds = null;

const checkbox1944 = document.getElementById('layer-1944');
const opacitySlider1944 = document.getElementById('opacity-1944');

checkbox1944.addEventListener('change', () => {
  if (checkbox1944.checked) {

    if (!layer1944) {
      const op = () => parseFloat(opacitySlider1944.value);
      // Format: [[southWestLat, southWestLng], [northEastLat, northEastLng]]
      const overlays = [
        L.imageOverlay('data/1944/1944_1.png', [[-32.923947, 151.702660], [-32.921560, 151.707930]], { opacity: op() }),
        L.imageOverlay('data/1944/1944_2.png', [[-32.923948, 151.706285], [-32.921676, 151.711515]], { opacity: op() }),
        L.imageOverlay('data/1944/1944_3.png', [[-32.925811, 151.706475], [-32.923578, 151.711834]], { opacity: op() }),
        L.imageOverlay('data/1944/1944_4.png', [[-32.925101, 151.698681], [-32.921265, 151.706880]], { opacity: op() }),
        L.imageOverlay('data/1944/1944_5.png', [[-32.957315, 151.622776], [-32.953600, 151.631125]], { opacity: op() }),
        L.imageOverlay('data/1944/1944_6.png', [[-32.960778, 151.622817], [-32.957005, 151.631085]], { opacity: op() }),
        L.imageOverlay('data/1944/1944_7.png', [[-32.965233, 151.625086], [-32.961603, 151.633358]], { opacity: op() }),
        L.imageOverlay('data/1944/1944_8.png', [[-32.929501, 151.704122], [-32.925730, 151.713770]], { opacity: op() }),
        L.imageOverlay('data/1944/1944_9.png', [[-32.963041, 151.633870], [-32.959149, 151.642005]], { opacity: op() })
      ];

      layer1944 = L.layerGroup(overlays);
      // Combined bounds for Zoom to
      layer1944Bounds = overlays.reduce((b, o) => {
        const ob = o.getBounds();
        return b ? b.extend(ob) : ob;
      }, null);
    }

    layer1944.addTo(map);

  } else {
    if (layer1944) map.removeLayer(layer1944);
  }
});
// Opacity slider controls all images
opacitySlider1944.addEventListener('input', () => {
  if (layer1944) {
    const v = parseFloat(opacitySlider1944.value);
    layer1944.eachLayer(l => l.setOpacity(v));
  }
});
// Zoom-to button zooms to the full extent of all images
document.getElementById('zoom-1944').addEventListener('click', () => {
  if (layer1944Bounds) map.fitBounds(layer1944Bounds);
});

    
     // Families move out of creep-damaged flats, 21st of June 
  let FamiliesMoveOutOfFlats1949 = null;

const FamiliesMoveOutOfFlatsCheckbox = document.getElementById('layer-1949-families-move-out-of-creep-damaged-flats');
const zoomFamiliesMoveOutOfFlats = document.getElementById('zoom-1949-families-move-out-of-creep-damaged-flats');
const FamiliesMoveOutOfFlatsLatLng = [-32.929396, 151.779889];


FamiliesMoveOutOfFlatsCheckbox.addEventListener('change', () => {
  if (FamiliesMoveOutOfFlatsCheckbox.checked) {

    if (!FamiliesMoveOutOfFlats1949) {
      const latlng = FamiliesMoveOutOfFlatsLatLng; 

      const previewImg = 'data/1949/19490621_FamiliesMoveOutOfCreepDamagedFlats.jpg';
      const pngUrl = 'data/1949/19490621_FamiliesMoveOutOfCreepDamagedFlats.jpg';

      const markerIcon = L.divIcon({
        className: 'photo-marker',
        html: '<div style="width:12px;height:12px;border-radius:50%;background:#d00;border:2px solid #fff;box-shadow:0 0 2px rgba(0,0,0,0.5);"></div>',
        iconSize: [12, 12],
        iconAnchor: [6, 6]
      });

      FamiliesMoveOutOfFlats1949 = L.marker(latlng, { icon: markerIcon });
     // Hover preview (popup that stays open when you move onto it)
const previewHtml = `
  <div>
    <div style="font-size:12px;margin-bottom:6px">
      Newcastle Morning Herald and Miners' Advocate, pg 2, 21st June 1949
    </div>
    <img src="${previewImg}">
  </div>
`;

const previewPopup = L.popup({
  closeButton: false,
  autoClose: false,
  closeOnClick: false,
  className: 'article-preview-popup',
  offset: [0, -10]
}).setContent(previewHtml);

let previewPinnedOpen = false;
let closeTimer = null;

FamiliesMoveOutOfFlats1949.on('mouseover', (e) => {
  previewPopup.setLatLng(e.latlng);
  previewPopup.openOn(map);

  // Wire mouse enter/leave on the popup element so it doesn't vanish
  setTimeout(() => {
    const el = previewPopup.getElement();
    if (!el) return;

    el.addEventListener('mouseenter', () => {
      previewPinnedOpen = true;
      if (closeTimer) clearTimeout(closeTimer);
    });

    el.addEventListener('mouseleave', () => {
      previewPinnedOpen = false;
      map.closePopup(previewPopup);
    });
  }, 0);
});

FamiliesMoveOutOfFlats1949.on('mouseout', () => {
  // Give you time to move from marker → popup without it closing
  closeTimer = setTimeout(() => {
    if (!previewPinnedOpen) map.closePopup(previewPopup);
  }, 200);
});
      // Click popup with explicit download link
      FamiliesMoveOutOfFlats1949.bindPopup(
        `<div style="width:260px">
           <div style="margin-bottom:8px">Download full-resolution image (JPG, ~86 KB)?</div>
           <a href="${pngUrl}" download style="display:inline-block;padding:6px 10px;border:1px solid #000;text-decoration:none;color:#000">
             Download JPG
           </a>
         </div>`
      );
    }

    FamiliesMoveOutOfFlats1949.addTo(map);

  } else {
    if (FamiliesMoveOutOfFlats1949) map.removeLayer(FamiliesMoveOutOfFlats1949);
  }
});
// Zoom-to button
zoomFamiliesMoveOutOfFlats.addEventListener('click', () => {
  map.setView(FamiliesMoveOutOfFlatsLatLng, 18);
});

// Photo: Boolaroo landslide scarps, 1st Sep 1949
let boolarooScarps1949Marker = null;

const boolarooScarps1949Checkbox = document.getElementById('layer-1949-boolaroo-scarps');
const zoomBoolarooScarps1949 = document.getElementById('zoom-1949-boolaroo-scarps');

const boolarooScarps1949LatLng = [-32.954528, 151.629154];

boolarooScarps1949Checkbox.addEventListener('change', () => {
  if (boolarooScarps1949Checkbox.checked) {

    if (!boolarooScarps1949Marker) {
      const previewImg = 'data/1949/19490901_BoolarooLandslide_preview.jpg';
      const fullresPngUrl = 'data/1949/19490901_BoolarooLandslide_fullres.png';

      const markerIcon = L.divIcon({
        className: 'photo-marker',
        html: '<div style="width:12px;height:12px;border-radius:50%;background:#ffffff;border:2px solid #fff;box-shadow:0 0 2px rgba(0,0,0,0.5);"></div>',
        iconSize: [12, 12],
        iconAnchor: [6, 6]
      });

      boolarooScarps1949Marker = L.marker(boolarooScarps1949LatLng, { icon: markerIcon });

      // Hover preview (tooltip) - wider preview (560px)
      boolarooScarps1949Marker.bindTooltip(
        `<div style="width:560px">
           <div style="font-size:12px;margin-bottom:6px">
             Boolaroo landslide 1949, facing N(?) atop Munibung Hill
           </div>
           <img src="${previewImg}" style="width:100%;height:auto;display:block;border:1px solid #ccc">
         </div>`,
        { direction: 'top', offset: [0, -10], opacity: 0.98, sticky: true }
      );

      // Click popup with explicit download link
      boolarooScarps1949Marker.bindPopup(
        `<div style="width:280px">
           <div style="margin-bottom:8px">Download full-resolution image (PNG)?</div>
           <a href="${fullresPngUrl}" download style="display:inline-block;padding:6px 10px;border:1px solid #000;text-decoration:none;color:#000">
             Download PNG
           </a>
         </div>`
      );
    }

    boolarooScarps1949Marker.addTo(map);

  } else {
    if (boolarooScarps1949Marker) map.removeLayer(boolarooScarps1949Marker);
  }
});
// Zoom-to button
zoomBoolarooScarps1949.addEventListener('click', () => {
  map.setView(boolarooScarps1949LatLng, 18);
});

    
    // Photo: Damage to 2 Third St, Boolaroo, 1st Sep 1949 (preview + download)
let photoDamage2ThirdSt1949 = null;

const photoDamage2ThirdStCheckbox = document.getElementById('layer-2thirdst-damage');
const zoomPhotoDamage2ThirdSt = document.getElementById('zoom-2thirdst-damage');

const photoDamage2ThirdStLatLng = [-32.95227, 151.62711];

photoDamage2ThirdStCheckbox.addEventListener('change', () => {
  if (photoDamage2ThirdStCheckbox.checked) {

    if (!photoDamage2ThirdSt1949) {
      const previewImg = 'data/1949/19490901_2ThirdStBoolaroo_preview.jpg';
      const fullresUrl = 'data/1949/19490901_2ThirdStBoolaroo_fullres.png';

      const markerIcon = L.divIcon({
        className: 'photo-marker',
        html: '<div style="width:12px;height:12px;border-radius:50%;background:#d00;border:2px solid #fff;box-shadow:0 0 2px rgba(0,0,0,0.5);"></div>',
        iconSize: [12, 12],
        iconAnchor: [6, 6]
      });

      photoDamage2ThirdSt1949 = L.marker(photoDamage2ThirdStLatLng, { icon: markerIcon });
      // Hover preview (tooltip)
      photoDamage2ThirdSt1949.bindTooltip(
        `<div style="width:560px">
           <div style="font-size:12px;margin-bottom:6px">Boolaroo 1949, facing SE</div>
           <img src="${previewImg}" style="width:100%;height:auto;display:block;border:1px solid #ccc">
         </div>`,
        { direction: 'top', offset: [0, -10], opacity: 0.98, sticky: true }
      );
      // Click popup with explicit download link
      photoDamage2ThirdSt1949.bindPopup(
        `<div style="width:260px">
           <div style="margin-bottom:8px">Download full-resolution image (PNG)?</div>
           <a href="${fullresUrl}" download style="display:inline-block;padding:6px 10px;border:1px solid #000;text-decoration:none;color:#000">
             Download PNG
           </a>
         </div>`
      );
    }

    photoDamage2ThirdSt1949.addTo(map);

  } else {
    if (photoDamage2ThirdSt1949) map.removeLayer(photoDamage2ThirdSt1949);
  }
});
// Zoom-to button
zoomPhotoDamage2ThirdSt.addEventListener('click', () => {
  map.setView(photoDamage2ThirdStLatLng, 18);
});

    
    // Boy walking west near Addison rd landslide, 1950
  let addison1950 = null;

const addisonCheckbox = document.getElementById('layer-1950-addison-boy-walking');
const zoomAddison = document.getElementById('zoom-1950-addison-boy-walking');
const addisonLatLng = [-32.92601, 151.709641];

addisonCheckbox.addEventListener('change', () => {
  if (addisonCheckbox.checked) {

    if (!addison1950) {
      const latlng = addisonLatLng; 

      const previewImg = 'data/1950/addison_rd_facing_east_preview.jpg';
      const pngUrl = 'data/1950/addison_rd_facing_east_fullres.png';

      const markerIcon = L.divIcon({
        className: 'photo-marker',
        html: '<div style="width:12px;height:12px;border-radius:50%;background:#fff;border:2px solid #fff;box-shadow:0 0 2px rgba(0,0,0,0.5);"></div>',
        iconSize: [12, 12],
        iconAnchor: [6, 6]
      });

      addison1950 = L.marker(latlng, { icon: markerIcon });
      // Hover preview (tooltip)
      addison1950.bindTooltip(
        `<div style="width:560px">
           <div style="font-size:12px;margin-bottom:6px">Addison Rd facing East, boy walking towards camera, landslide visible in foreground (1st Sep 1950)</div>
           <img src="${previewImg}" style="width:100%;height:auto;display:block;border:1px solid #ccc">
         </div>`,
        { direction: 'top', offset: [0, -10], opacity: 0.98, sticky: true }
      );
      // Click popup with explicit download link
      addison1950.bindPopup(
        `<div style="width:560px">
           <div style="margin-bottom:8px">Download full-resolution image (PNG, ~43 MB)?</div>
           <a href="${pngUrl}" download style="display:inline-block;padding:6px 10px;border:1px solid #000;text-decoration:none;color:#000">
             Download PNG
           </a>
         </div>`
      );
    }

    addison1950.addTo(map);

  } else {
    if (addison1950) map.removeLayer(addison1950);
  }
});
// Zoom-to button
zoomAddison.addEventListener('click', () => {
  map.setView(addisonLatLng, 18);
});


  // Woman in car, numbers 28-32 Addison Rd, 1950
  let addison28to32_1950 = null;

const addison28to32Checkbox = document.getElementById('layer-1950-addison-28-30-32');
const zoomaddison28to32 = document.getElementById('zoom-1950-addison-28-30-32');
const addison28to32LatLng = [-32.926461, 151.708670];

addison28to32Checkbox.addEventListener('change', () => {
  if (addison28to32Checkbox.checked) {

    if (!addison28to32_1950) {
      const latlng = addison28to32LatLng; 

      const previewImg = 'data/1950/28_30_32_AddisonRd_preview.jpg';
      const pngUrl = 'data/1950/28_30_32_AddisonRd_fullres.png';

      const markerIcon = L.divIcon({
        className: 'photo-marker',
        html: '<div style="width:12px;height:12px;border-radius:50%;background:#d00;border:2px solid #ffffff;box-shadow:0 0 2px rgba(0,0,0,0.5);"></div>',
        iconSize: [12, 12],
        iconAnchor: [6, 6]
      });

      addison28to32_1950 = L.marker(latlng, { icon: markerIcon });
      // Hover preview (tooltip)
      addison28to32_1950.bindTooltip(
        `<div style="width:560px">
           <div style="font-size:12px;margin-bottom:6px">“The Slip”, New Lambton, 1st Sep 1950. 28, 30 & 32 Addison Rd can be seen on the right.</div>
           <img src="${previewImg}" style="width:100%;height:auto;display:block;border:1px solid #ccc">
         </div>`,
        { direction: 'top', offset: [0, -10], opacity: 0.98, sticky: true }
      );
      // Click popup with explicit download link
      addison28to32_1950.bindPopup(
        `<div style="width:560px">
           <div style="margin-bottom:8px">Download full-resolution image (PNG, ~43 MB)?</div>
           <a href="${pngUrl}" download style="display:inline-block;padding:6px 10px;border:1px solid #000;text-decoration:none;color:#000">
             Download PNG
           </a>
         </div>`
      );
    }

    addison28to32_1950.addTo(map);

  } else {
    if (addison28to32_1950) map.removeLayer(addison28to32_1950);
  }
});
// Zoom-to button
zoomaddison28to32.addEventListener('click', () => {
  map.setView(addison28to32LatLng, 18);
});
    
// Photo: 19th Jan 1951 Chelston St Landslide Mr & Mrs Howell's house
let chelstonSt1951 = null;

const chelstonStCheckbox = document.getElementById('layer-1951-chelston-st');
const zoomChelstonSt = document.getElementById('zoom-1951-chelston-st');

const chelstonStLatLng = [-32.96151, 151.64054];

chelstonStCheckbox.addEventListener('change', () => {
  if (chelstonStCheckbox.checked) {

    if (!chelstonSt1951) {
      const previewImg = 'data/1951/19510119_ChelstonStLandslide.png';

      const markerIcon = L.divIcon({
        className: 'photo-marker',
        html: `
          <div style="
            width:12px;
            height:12px;
            border-radius:50%;
            background:#d00;
            border:2px solid #fff;
            box-shadow:0 0 2px rgba(0,0,0,0.5);
          "></div>
        `,
        iconSize: [12, 12],
        iconAnchor: [6, 6]
      });

      chelstonSt1951 = L.marker(chelstonStLatLng, { icon: markerIcon });

      // Hover preview
      chelstonSt1951.bindTooltip(
        `<div style="width:560px">
           <div style="font-size:12px;margin-bottom:6px">
             Mr & Mrs Howell’s house stood at what is now 20 Chelston St, Warners Bay.
           </div>
           <img src="${previewImg}"
                style="width:100%;height:auto;display:block;border:1px solid #ccc">
         </div>`,
        { direction: 'top', offset: [0, -10], opacity: 0.98, sticky: true }
      );

      // Click popup – external thesis link (no download attribute)
      chelstonSt1951.bindPopup(
        `<div style="width:300px">
           <div style="margin-bottom:8px">
             Source document:
           </div>
           <a href="https://unsworks.unsw.edu.au/entities/publication/8ef29976-5802-4702-9719-52f913e3f133"
              target="_blank"
              rel="noopener noreferrer"
              style="display:inline-block;padding:6px 10px;border:1px solid #000;text-decoration:none;color:#000">
             Thesis: Three-dimensional, transient piezometric response in landslides to rainfall. Williams-Sweeney, Kelly S.
           </a>
         </div>`
      );
    }

    chelstonSt1951.addTo(map);

  } else {
    if (chelstonSt1951) map.removeLayer(chelstonSt1951);
  }
});

// Zoom-to button
zoomChelstonSt.addEventListener('click', () => {
  map.setView(chelstonStLatLng, 18);
});
  
// Photo: 19th Jan 1951 Chelston St Landslide (flow path)
let chelstonSt1951FlowPath = null;

const chelstonStFlowCheckbox = document.getElementById('layer-1951-chelston-st-flowpath');
const zoomChelstonStFlow = document.getElementById('zoom-1951-chelston-st-flowpath');

const chelstonStFlowLatLng = [-32.960548, 151.639414];

chelstonStFlowCheckbox.addEventListener('change', () => {
  if (chelstonStFlowCheckbox.checked) {

    if (!chelstonSt1951FlowPath) {
      const previewImg = 'data/1951/19510119_ChelstonStLandslide_FlowPath.png';

      const markerIcon = L.divIcon({
        className: 'photo-marker',
        html: `
          <div style="
            width:12px;
            height:12px;
            border-radius:50%;
            background:#fff;
            border:2px solid #000;
            box-shadow:0 0 2px rgba(0,0,0,0.6);
          "></div>
        `,
        iconSize: [12, 12],
        iconAnchor: [6, 6]
      });

      chelstonSt1951FlowPath = L.marker(chelstonStFlowLatLng, { icon: markerIcon });

      // Hover preview (tooltip)
      chelstonSt1951FlowPath.bindTooltip(
        `<div style="width:560px">
           <div style="font-size:12px;margin-bottom:6px">
             The 1951 Chelston St landslide in Warners Bay covered 3–4 ha and created scarps up to 2.5 m high.
           </div>
           <img src="${previewImg}"
                style="width:100%;height:auto;display:block;border:1px solid #ccc">
         </div>`,
        { direction: 'top', offset: [0, -10], opacity: 0.98, sticky: true }
      );

      // Click popup – external thesis link
      chelstonSt1951FlowPath.bindPopup(
        `<div style="width:320px">
           <div style="margin-bottom:8px">Source document:</div>
           <a href="https://unsworks.unsw.edu.au/entities/publication/8ef29976-5802-4702-9719-52f913e3f133"
              target="_blank"
              rel="noopener noreferrer"
              style="display:inline-block;padding:6px 10px;border:1px solid #000;text-decoration:none;color:#000">
             Thesis: Three-dimensional, transient piezometric response in landslides to rainfall. Williams-Sweeney, Kelly S.
           </a>
         </div>`
      );
    }

    chelstonSt1951FlowPath.addTo(map);

  } else {
    if (chelstonSt1951FlowPath) map.removeLayer(chelstonSt1951FlowPath);
  }
});

// Zoom-to button
zoomChelstonStFlow.addEventListener('click', () => {
  map.setView(chelstonStFlowLatLng, 18);
});


// Photo: 22 Mar 1953 – The Slip moved again
let TheSlipMovedAgain1953 = null;

const TheSlipMovedAgain1953Checkbox = document.getElementById('layer-1953-addison-facing-w');
const zoomTheSlipMovedAgain1953 = document.getElementById('zoom-1953-addison-facing-w');

const TheSlipMovedAgain1953LatLng = [-32.926608, 151.708110];

TheSlipMovedAgain1953Checkbox.addEventListener('change', () => {
  if (TheSlipMovedAgain1953Checkbox.checked) {

    if (!TheSlipMovedAgain1953) {
      const previewImg = 'data/1953/19530322_AddisonRdFacingW.png';
      const pngUrl = 'data/1953/19530322_AddisonRdFacingW.png'; // or your full-res file

      const markerIcon = L.divIcon({
        className: 'photo-marker',
        html: `
          <div style="
            width:12px;
            height:12px;
            border-radius:50%;
            background:#fff;
            border:2px solid #000;
            box-shadow:0 0 2px rgba(0,0,0,0.6);
          "></div>
        `,
        iconSize: [12, 12],
        iconAnchor: [6, 6]
      });

      TheSlipMovedAgain1953 = L.marker(TheSlipMovedAgain1953LatLng, { icon: markerIcon });

      TheSlipMovedAgain1953.bindTooltip(
        `<div style="width:560px">
           <div style="font-size:12px;margin-bottom:6px">
             Earthworks being undertaken after further movement.
           </div>
           <img src="${previewImg}" style="width:100%;height:auto;display:block;border:1px solid #ccc">
         </div>`,
        { direction: 'top', offset: [0, -10], opacity: 0.98, sticky: true }
      );

      TheSlipMovedAgain1953.bindPopup(
        `<div style="width:560px">
           <div style="margin-bottom:8px">Download full-resolution image (PNG, ~18 MB)?</div>
           <a href="${pngUrl}" download
              style="display:inline-block;padding:6px 10px;border:1px solid #000;text-decoration:none;color:#000">
             Download PNG
           </a>
         </div>`
      );
    }

    TheSlipMovedAgain1953.addTo(map);

  } else {
    if (TheSlipMovedAgain1953) map.removeLayer(TheSlipMovedAgain1953);
  }
});

zoomTheSlipMovedAgain1953.addEventListener('click', () => {
  map.setView(TheSlipMovedAgain1953LatLng, 18);
});

// Photo: Men & children surveying renewed movement in "The Slip", 22 Mar 1953
let menAndChildren1953 = null;

const menAndChildren1953Checkbox =
  document.getElementById('layer-1953-addison-men-and-children');
const zoomMenAndChildren1953 =
  document.getElementById('zoom-1953-addison-men-and-children');

const menAndChildren1953LatLng = [-32.926549, 151.708099];

menAndChildren1953Checkbox.addEventListener('change', () => {
  if (menAndChildren1953Checkbox.checked) {

    if (!menAndChildren1953) {
      const imgUrl = 'data/1953/19530322_AddisonRdMenAndChildren.png';

      const markerIcon = L.divIcon({
        className: 'photo-marker',
        html: `
          <div style="
            width:12px;
            height:12px;
            border-radius:50%;
            background:#d00;
            border:2px solid #fff;
            box-shadow:0 0 2px rgba(0,0,0,0.6);
          "></div>
        `,
        iconSize: [12, 12],
        iconAnchor: [6, 6]
      });

      menAndChildren1953 = L.marker(menAndChildren1953LatLng, {
        icon: markerIcon
      });

      // Hover preview
      menAndChildren1953.bindTooltip(
        `<div style="width:560px">
           <div style="font-size:12px;margin-bottom:6px">
             Men & children surveying The Slip. Addison Rd facing west, 22nd March 1953
           </div>
           <img src="${imgUrl}"
                style="width:100%;height:auto;display:block;border:1px solid #ccc">
         </div>`,
        { direction: 'top', offset: [0, -10], opacity: 0.98, sticky: true }
      );

      // Click popup (download)
      menAndChildren1953.bindPopup(
        `<div style="width:260px">
           <div style="margin-bottom:8px">
             Download full-resolution image (PNG, ~18&nbsp;MB)?
           </div>
           <a href="${imgUrl}" download
              style="display:inline-block;padding:6px 10px;border:1px solid #000;
                     text-decoration:none;color:#000">
             Download PNG
           </a>
         </div>`
      );
    }

    menAndChildren1953.addTo(map);

  } else {
    if (menAndChildren1953) map.removeLayer(menAndChildren1953);
  }
});

// Zoom-to
zoomMenAndChildren1953.addEventListener('click', () => {
  map.setView(menAndChildren1953LatLng, 18);
});


// Photo: Residents surveying "The Slip", 22 Mar 1953
let residentsSurveying1953 = null;

const residentsSurveying1953Checkbox =
  document.getElementById('layer-1953-addison-residents-surveying-movement');
const zoomResidentsSurveying1953 =
  document.getElementById('zoom-1953-addison-residents-surveying-movement');

const residentsSurveying1953LatLng = [-32.926549, 151.707994];

residentsSurveying1953Checkbox.addEventListener('change', () => {
  if (residentsSurveying1953Checkbox.checked) {

    if (!residentsSurveying1953) {
      const imgUrl = 'data/1953/19530322_MenStandingAddisonRdLandslide.png';

      const markerIcon = L.divIcon({
        className: 'photo-marker',
        html: `
          <div style="
            width:12px;
            height:12px;
            border-radius:50%;
            background:#fff;
            border:2px solid #000;
            box-shadow:0 0 2px rgba(0,0,0,0.6);
          "></div>
        `,
        iconSize: [12, 12],
        iconAnchor: [6, 6]
      });

      residentsSurveying1953 = L.marker(residentsSurveying1953LatLng, {
        icon: markerIcon
      });

      // Hover preview
      residentsSurveying1953.bindTooltip(
        `<div style="width:560px">
           <div style="font-size:12px;margin-bottom:6px">
             Residents surveying The Slip. Addison Rd facing west, 22nd March 1953
           </div>
           <img src="${imgUrl}"
                style="width:100%;height:auto;display:block;border:1px solid #ccc">
         </div>`,
        { direction: 'top', offset: [0, -10], opacity: 0.98, sticky: true }
      );

      // Click popup (download)
      residentsSurveying1953.bindPopup(
        `<div style="width:260px">
           <div style="margin-bottom:8px">
             Download full-resolution image (PNG, ~6&nbsp;MB)?
           </div>
           <a href="${imgUrl}" download
              style="display:inline-block;padding:6px 10px;border:1px solid #000;
                     text-decoration:none;color:#000">
             Download PNG
           </a>
         </div>`
      );
    }

    residentsSurveying1953.addTo(map);

  } else {
    if (residentsSurveying1953) map.removeLayer(residentsSurveying1953);
  }
});

// Zoom-to
zoomResidentsSurveying1953.addEventListener('click', () => {
  map.setView(residentsSurveying1953LatLng, 18);
});

  

// 1954 Imagery (multi-image layer group)
let layer1954imagery = null;
let layer1954imageryBounds = null;

const checkbox1954imagery = document.getElementById('layer-1954-imagery');
const opacitySlider1954imagery = document.getElementById('opacity-1954-imagery');
const zoomBtn1954imagery = document.getElementById('zoom-1954-imagery');

// Guard (prevents script death if IDs are wrong)
if (!checkbox1954imagery || !opacitySlider1954imagery || !zoomBtn1954imagery) {
  console.warn('1954 imagery UI elements missing');
} else {
  checkbox1954imagery.addEventListener('change', () => {
    if (checkbox1954imagery.checked) {
      if (!layer1954imagery) {
        const op = () => parseFloat(opacitySlider1954imagery.value);
      // Format: [[southWestLat, southWestLng], [northEastLat, northEastLng]]
        const overlays = [
          L.imageOverlay('data/1954/1954_1.png', [[-32.968806, 151.623713], [-32.958380, 151.642633]], { opacity: op() }),
          L.imageOverlay('data/1954/1954_2.png', [[-32.960010, 151.624210], [-32.950120, 151.645000]], { opacity: op() }),
          L.imageOverlay('data/1954/1954_3.png', [[-32.930206, 151.699598], [-32.920282, 151.715371]], { opacity: op() }),
          L.imageOverlay('data/1954/1954_4.png', [[-32.968806, 151.624210], [-32.960010, 151.645000]], { opacity: op() })
        ];

        layer1954imagery = L.layerGroup(overlays);

        layer1954imageryBounds = overlays.reduce((b, o) => {
          const ob = o.getBounds();
          return b ? b.extend(ob) : ob;
        }, null);
      }

      layer1954imagery.addTo(map);
    } else {
      if (layer1954imagery) map.removeLayer(layer1954imagery);
    }
  });

  opacitySlider1954imagery.addEventListener('input', () => {
    if (!layer1954imagery) return;
    const v = parseFloat(opacitySlider1954imagery.value);
    layer1954imagery.eachLayer(l => l.setOpacity(v));
  });

  zoomBtn1954imagery.addEventListener('click', () => {
    if (layer1954imageryBounds) map.fitBounds(layer1954imageryBounds);
  });
}


// 1966 Aerial imagery (single image overlay)
let imagery1966Overlay = null;

const imagery1966Checkbox = document.getElementById('layer-1966-imagery');
const imagery1966OpacitySlider = document.getElementById('opacity-1966-imagery');
const imagery1966ZoomBtn = document.getElementById('zoom-1966-imagery');

if (!imagery1966Checkbox || !imagery1966OpacitySlider || !imagery1966ZoomBtn) {
  console.warn('1966 imagery UI elements missing');
} else {
  const imagery1966Bounds = L.latLngBounds(
    [-32.92897, 151.69575], // SW
    [-32.91194, 151.71288]  // NE
  );

  imagery1966Checkbox.addEventListener('change', () => {
    if (imagery1966Checkbox.checked) {
      if (!imagery1966Overlay) {
        imagery1966Overlay = L.imageOverlay(
          'data/1966/AerialImagery1966.png',
          imagery1966Bounds,
          { opacity: parseFloat(imagery1966OpacitySlider.value) }
        );
      }
      imagery1966Overlay.addTo(map);
    } else {
      if (imagery1966Overlay) map.removeLayer(imagery1966Overlay);
    }
  });

  imagery1966OpacitySlider.addEventListener('input', () => {
    if (imagery1966Overlay) {
      imagery1966Overlay.setOpacity(parseFloat(imagery1966OpacitySlider.value));
    }
  });

  imagery1966ZoomBtn.addEventListener('click', () => {
    map.fitBounds(imagery1966Bounds, { maxZoom: 20 });
  });
}




// 1969 MidWest Ward Map
let midwest1969 = null;

const checkbox1969 = document.getElementById('layer-1969-midwest');
const opacitySlider1969 = document.getElementById('opacity-1969-midwest');

checkbox1969.addEventListener('change', () => {
  if (checkbox1969.checked) {
    if (!midwest1969) {
      const imageUrl = 'data/1969/1969_MidWestWard_Map.png';

      // Placeholder bounds - tune after you see it
      const bounds = [
        [-32.926804, 151.697313],  // south-west
        [-32.919876, 151.706994]   // north-east
      ];

      midwest1969 = L.imageOverlay(imageUrl, bounds, {
        opacity: parseFloat(opacitySlider1969.value)
      });
    }

    midwest1969.addTo(map);
  } else {
    if (midwest1969) map.removeLayer(midwest1969);
  }
});

opacitySlider1969.addEventListener('input', () => {
  if (midwest1969) midwest1969.setOpacity(parseFloat(opacitySlider1969.value));
});

document.getElementById('zoom-1969-midwest').addEventListener('click', () => {
  if (midwest1969) map.fitBounds(midwest1969.getBounds());
});


// ---------- 1957 overlay "marker" (Council acquisition of part of 11 Addison Rd) ----------
let councilAcq11Addison1957 = null;

const councilAcq11Addison1957Checkbox = document.getElementById('layer-1957-council-acquisition-11-addison');
const zoomCouncilAcq11Addison1957Btn = document.getElementById('zoom-1957-council-acquisition-11-addison');

// Bounds (SW, NE)
const councilAcq11Addison1957Bounds = [
  [-32.926215, 151.709023], // SW
  [-32.9261435, 151.7092189]  // NE
];

// Guard (prevents script death if IDs are wrong)
if (!councilAcq11Addison1957Checkbox || !zoomCouncilAcq11Addison1957Btn) {
  console.warn('1957 council acquisition UI elements missing');
} else {

  councilAcq11Addison1957Checkbox.addEventListener('change', () => {
    if (councilAcq11Addison1957Checkbox.checked) {

      if (!councilAcq11Addison1957) {
        const markerImgUrl = 'data/1957/CouncilAcquisition11Addison.png';

        councilAcq11Addison1957 = L.imageOverlay(
  markerImgUrl,
  councilAcq11Addison1957Bounds,
  {
    opacity: 1,
    interactive: true,   // ← REQUIRED for hover/click
    zIndex: 400          // ← keeps it above imagery
  }
);


        // Hover preview (popup with image + caption, 560px wide)
        const previewImgUrl = 'data/1957/SaleOfPart11AddisonToNCC14thAug1957Vol-Fol3860-53.png';
        const previewTitle = 'Vol-fol 3860-53';

        const previewHtml = `
          <div style="width:560px">
            <div style="font-size:12px;margin-bottom:6px">${previewTitle}</div>
            <img src="${previewImgUrl}" style="width:100%;height:auto;display:block;border:1px solid #ccc">
          </div>
        `;

        const previewPopup = L.popup({
          closeButton: false,
          autoClose: false,
          closeOnClick: false,
          className: 'article-preview-popup',
          offset: [0, -10]
        }).setContent(previewHtml);

        let pinned = false;
        let closeTimer = null;

        councilAcq11Addison1957.on('mouseover', (e) => {
          previewPopup.setLatLng(e.latlng).openOn(map);

          setTimeout(() => {
            const el = previewPopup.getElement();
            if (!el) return;
            el.onmouseenter = () => { pinned = true; };
            el.onmouseleave = () => { pinned = false; map.closePopup(previewPopup); };
          }, 0);
        });

        councilAcq11Addison1957.on('mouseout', () => {
          closeTimer = setTimeout(() => {
            if (!pinned) map.closePopup(previewPopup);
          }, 200);
        });

        // Click popup (download button)
        const downloadDocUrl = 'data/HowToFindVol-Fol.odt';

        councilAcq11Addison1957.on('click', (e) => {
          L.popup({ offset: [0, -10] })
            .setLatLng(e.latlng)
            .setContent(`
              <div style="width:320px">
                <div style="margin-bottom:8px">
                  Sale is documented in Certificate of Title (CoT), vol-fol 3860-53
                </div>
                <a href="${downloadDocUrl}" download
                   style="display:inline-block;padding:6px 10px;border:1px solid #000;text-decoration:none;color:#000">
                  Download “How to find CoT by vol-fol” (~0.1 MB)
                </a>
              </div>
            `)
            .openOn(map);
        });
      }

      councilAcq11Addison1957.addTo(map);

    } else {
      if (councilAcq11Addison1957) map.removeLayer(councilAcq11Addison1957);
    }
  });

  // Zoom-to button
 zoomCouncilAcq11Addison1957Btn.addEventListener('click', () => {
  map.fitBounds(councilAcq11Addison1957Bounds, {
    padding: [40, 40],
    maxZoom: 19
  });
});


}


// 1957: Council acquisition (part of 13 Addison Rd) — image "marker" overlay with hover preview + click download

let acq13Addison1957 = null;
let acq13Addison1957Bounds = null;

const cbAcq13 = document.getElementById('layer-1957-acq-13-addison');
const zoomAcq13 = document.getElementById('zoom-1957-acq-13-addison');
const opAcq13 = document.getElementById('opacity-1957-acq-13-addison');

if (!cbAcq13 || !zoomAcq13 || !opAcq13) {
  console.warn('1957 acq 13 Addison UI elements missing');
} else {
  // Bounds (SW, NE)
  acq13Addison1957Bounds = L.latLngBounds(
    [-32.92629, 151.70879], // SW
    [-32.92619, 151.70903]  // NE
  );

  cbAcq13.addEventListener('change', () => {
    if (cbAcq13.checked) {
      if (!acq13Addison1957) {
        acq13Addison1957 = L.imageOverlay(
          'data/1957/CouncilAcquisition13Addison.png',
          acq13Addison1957Bounds,
          { opacity: parseFloat(opAcq13.value), interactive: true } // interactive is required for hover/click
        );

        // Hover preview (tooltip)
        acq13Addison1957.bindTooltip(
          `<div style="width:560px">
             <div style="font-size:12px;margin-bottom:6px">Vol-fol 5684-69</div>
             <img src="data/1957/SaleOfPart13AddisonToNCC7thNov1957Vol-Fol5684-69.png"
                  style="width:100%;height:auto;display:block;border:1px solid #ccc">
           </div>`,
          { direction: 'top', offset: [0, -10], opacity: 0.98, sticky: true }
        );

        // Click popup with download button
        acq13Addison1957.bindPopup(
          `<div style="width:320px">
             <div style="margin-bottom:8px">Sale is documented in Certificate of Title (CoT), vol-fol 5684-69</div>
             <a href="data/HowToFindVol-Fol.odt" download
                style="display:inline-block;padding:6px 10px;border:1px solid #000;text-decoration:none;color:#000">
               Download “How to find CoT by vol-fol” (~0.1 MB)
             </a>
           </div>`
        );
      }

      acq13Addison1957.addTo(map);
    } else {
      if (acq13Addison1957) map.removeLayer(acq13Addison1957);
    }
  });

  opAcq13.addEventListener('input', () => {
    if (acq13Addison1957) acq13Addison1957.setOpacity(parseFloat(opAcq13.value));
  });

  zoomAcq13.addEventListener('click', () => {
    map.fitBounds(acq13Addison1957Bounds, { maxZoom: 20 }); // stops it zooming in beyond reason
  });
}

  
// 1958: Council acquisition part of 15 Addison Rd (image "marker" overlay + hover preview + click download)
let acquisition15Addison1958 = null;

const cb1958 = document.getElementById('layer-1958-addison15-acq');
const zoom1958 = document.getElementById('zoom-1958-addison15-acq');

// Guard
if (!cb1958 || !zoom1958) {
  console.warn('1958 layer UI elements missing');
} else {
  const bounds1958 = L.latLngBounds(
    [-32.926379, 151.708531], // SW
    [-32.926264, 151.708799]  // NE
  );

  cb1958.addEventListener('change', () => {
    if (cb1958.checked) {
      if (!acquisition15Addison1958) {
        // Overlay image used as the "marker"
        acquisition15Addison1958 = L.imageOverlay(
          'data/1958/CouncilAcquisition15Addison.png',
          bounds1958,
          { interactive: true, opacity: 1 }
        );

        // Hover preview (tooltip)
        const previewImg = 'data/1958/SaleOfPart15AddisonToNCC21stMay1958Vol-Fol3859-233.png';
        acquisition15Addison1958.bindTooltip(
          `<div style="width:560px">
             <div style="font-size:12px;margin-bottom:6px">Vol-fol 3859-233</div>
             <img src="${previewImg}" style="width:100%;height:auto;display:block;border:1px solid #ccc">
           </div>`,
          { direction: 'top', offset: [0, -10], opacity: 0.98, sticky: true }
        );

        // Click popup with download button (ODT)
        const odtUrl = 'data/HowToFindVol-Fol.odt';
        acquisition15Addison1958.bindPopup(
          `<div style="width:300px">
             <div style="margin-bottom:8px">Sale is documented in Certificate of Title (CoT), vol-fol 3859-233</div>
             <a href="${odtUrl}" download
                style="display:inline-block;padding:6px 10px;border:1px solid #000;text-decoration:none;color:#000">
               Download “How to find CoT by vol-fol” (~0.1 MB)
             </a>
           </div>`
        );
      }

      acquisition15Addison1958.addTo(map);
    } else {
      if (acquisition15Addison1958) map.removeLayer(acquisition15Addison1958);
    }
  });

  // Zoom-to button (don’t zoom past your basemap)
  zoom1958.addEventListener('click', () => {
    map.fitBounds(bounds1958, { maxZoom: 20 });
  });
}

  

// 1983: LMCC commissions Coffey (soil investigation marker + download prompt)
let coffeyCommission1983Marker = null;

const coffeyCommission1983Checkbox = document.getElementById('layer-1983-coffey-commissioned');
const zoomCoffeyCommission1983 = document.getElementById('zoom-1983-coffey-commissioned');

const coffeyCommission1983LatLng = [-32.953867, 151.640977];

// Marker icon (SVG file stored under /data/)
const soilInvestigationIcon = L.icon({
  iconUrl: 'data/soil_investigation_marker.png',
  iconSize: [15, 15],
  iconAnchor: [7, 12]
});

coffeyCommission1983Checkbox.addEventListener('change', () => {
  if (coffeyCommission1983Checkbox.checked) {

    if (!coffeyCommission1983Marker) {
      coffeyCommission1983Marker = L.marker(coffeyCommission1983LatLng, { icon: soilInvestigationIcon });

      // Hover tooltip (your "download prompt" on hover)
      coffeyCommission1983Marker.bindTooltip(
        `<div style="width:260px">
           <div style="margin-bottom:8px">Download file “PlaceHolder”?</div>
           <a href="#" onclick="return false;"
              style="display:inline-block;padding:6px 10px;border:1px solid #000;text-decoration:none;color:#000">
             PlaceHolder (not available yet)
           </a>
         </div>`,
        { direction: 'top', offset: [0, -10], opacity: 0.98, sticky: true }
      );

      // Optional: also show same prompt on click (keeps behaviour consistent on mobile)
      coffeyCommission1983Marker.bindPopup(
        `<div style="width:260px">
           <div style="margin-bottom:8px">Download file “PlaceHolder”?</div>
           <a href="#" onclick="return false;"
              style="display:inline-block;padding:6px 10px;border:1px solid #000;text-decoration:none;color:#000">
             PlaceHolder (not available yet)
           </a>
         </div>`
      );
    }

    coffeyCommission1983Marker.addTo(map);

  } else {
    if (coffeyCommission1983Marker) map.removeLayer(coffeyCommission1983Marker);
  }
});

// Zoom-to button
zoomCoffeyCommission1983.addEventListener('click', () => {
  map.setView(coffeyCommission1983LatLng, 18);
});


// 1984 — LMCC first geotechnical zoning map (marker + hover preview + PDF download)
let lmccGeotechZoning1984Marker = null;

const lmccGeotechZoning1984Checkbox = document.getElementById('layer-1984-lmcc-first-geotech-zoning');
const zoomLmccGeotechZoning1984 = document.getElementById('zoom-1984-lmcc-first-geotech-zoning');
const lmccGeotechZoning1984LatLng = [-32.96022, 151.62376];

lmccGeotechZoning1984Checkbox.addEventListener('change', () => {
  if (lmccGeotechZoning1984Checkbox.checked) {

    if (!lmccGeotechZoning1984Marker) {
      const previewImg = 'data/1992/LMCC_GeotechZoning1984_Fell_R.1992.png';
      const pdfUrl = 'data/1992/R.Fell_1992_LandslideRiskZoningSchemesInUse.pdf';

      const markerIcon = L.icon({
        iconUrl: 'data/soil_investigation_marker.png',
        iconSize: [15, 15],
        iconAnchor: [7, 7]
      });

      lmccGeotechZoning1984Marker = L.marker(lmccGeotechZoning1984LatLng, { icon: markerIcon });

      // Hover preview (tooltip)
      lmccGeotechZoning1984Marker.bindTooltip(
        `<div style="width:480px">
           <img src="${previewImg}" style="width:100%;height:auto;display:block;border:1px solid #ccc">
         </div>`,
        { direction: 'top', offset: [0, -10], opacity: 0.98, sticky: true }
      );

      // Click popup (download PDF)
      lmccGeotechZoning1984Marker.bindPopup(
        `<div style="width:260px">
           <div style="margin-bottom:8px">Download PDF (~0.6 MB)?</div>
           <a href="${pdfUrl}" download
              style="display:inline-block;padding:6px 10px;border:1px solid #000;text-decoration:none;color:#000">
             Download PDF
           </a>
         </div>`
      );
    }

    lmccGeotechZoning1984Marker.addTo(map);

  } else {
    if (lmccGeotechZoning1984Marker) map.removeLayer(lmccGeotechZoning1984Marker);
  }
});

// Zoom-to button
zoomLmccGeotechZoning1984.addEventListener('click', () => {
  map.setView(lmccGeotechZoning1984LatLng, 16);
});

  

// Photo: 29th April 1988 Chelston St Landslide (preview + download)
let chelstonSt1988_29Apr = null;

const chelstonSt1988Checkbox = document.getElementById('layer-1988-chelston-st-29apr');
const zoomChelstonSt1988 = document.getElementById('zoom-1988-chelston-st-29apr');

const chelstonSt1988LatLng = [-32.959730, 151.637663];

chelstonSt1988Checkbox.addEventListener('change', () => {
  if (chelstonSt1988Checkbox.checked) {

    if (!chelstonSt1988_29Apr) {
      const previewImg = 'data/1988/ChelstonStreetLandslide_29Apr1988.jpg';
      const fullresUrl = 'data/1988/ChelstonStreetLandslide_29Apr1988.jpg';

      const markerIcon = L.divIcon({
        className: 'photo-marker',
        html: '<div style="width:12px;height:12px;border-radius:50%;background:#d00;border:2px solid #fff;box-shadow:0 0 2px rgba(0,0,0,0.5);"></div>',
        iconSize: [12, 12],
        iconAnchor: [6, 6]
      });

      chelstonSt1988_29Apr = L.marker(chelstonSt1988LatLng, { icon: markerIcon });

      // Hover preview (tooltip)
      chelstonSt1988_29Apr.bindTooltip(
        `<div style="width:560px">
           <div style="font-size:12px;margin-bottom:6px">
             Monitoring stations captured movement in the 1988 Chelston St landslide from 12 Apr, and the major mvmt was on the 29th.
           </div>
           <img src="${previewImg}" style="width:100%;height:auto;display:block;border:1px solid #ccc">
         </div>`,
        { direction: 'top', offset: [0, -10], opacity: 0.98, sticky: true }
      );

      // Click popup with explicit download link
      chelstonSt1988_29Apr.bindPopup(
        `<div style="width:260px">
           <div style="margin-bottom:8px">Download image (JPG)?</div>
           <a href="${fullresUrl}" download style="display:inline-block;padding:6px 10px;border:1px solid #000;text-decoration:none;color:#000">
             Download JPG
           </a>
         </div>`
      );
    }

    chelstonSt1988_29Apr.addTo(map);

  } else {
    if (chelstonSt1988_29Apr) map.removeLayer(chelstonSt1988_29Apr);
  }
});

// Zoom-to button
zoomChelstonSt1988.addEventListener('click', () => {
  map.setView(chelstonSt1988LatLng, 18);
});


// ---------- 2023 Satellite imagery (single image overlay) ----------
wireOverlayLayer({
  checkboxId: 'layer-2023-sat',
  sliderId: 'opacity-2023-sat',
  zoomBtnId: 'zoom-2023-sat',
  imageUrl: 'data/2023/MetroMap_Download_Newcastle_2023_13_GM_2023-10-15.jpg',
  bounds: [
    [-32.92454, 151.70698], // SW
    [-32.922249, 151.71035]  // NE
  ]
});

  

    // ---------- Helpers (reuse everywhere) ----------
function makeDotIcon(colour = '#d00') {
  return L.divIcon({
    className: 'photo-marker',
    html: `
      <div style="
        width:12px;
        height:12px;
        border-radius:50%;
        background:${colour};
        border:2px solid #fff;
        box-shadow:0 0 2px rgba(0,0,0,0.5);
      "></div>
    `,
    iconSize: [12, 12],
    iconAnchor: [6, 6]
  });
}


function wireOverlayLayer({
  checkboxId,
  sliderId,
  zoomBtnId,
  imageUrl,
  bounds
}) {
  let overlay = null;

  const cb = document.getElementById(checkboxId);
  const slider = document.getElementById(sliderId);
  const zoomBtn = document.getElementById(zoomBtnId);

  cb.addEventListener('change', () => {
    if (cb.checked) {
      if (!overlay) {
        overlay = L.imageOverlay(imageUrl, bounds, { opacity: parseFloat(slider.value) });
      }
      overlay.addTo(map);
    } else {
      if (overlay) map.removeLayer(overlay);
    }
  });

  slider.addEventListener('input', () => {
    if (overlay) overlay.setOpacity(parseFloat(slider.value));
  });

  zoomBtn.addEventListener('click', () => {
    if (overlay) map.fitBounds(overlay.getBounds());
    else map.fitBounds(bounds);
  });
}

function wireHoverPreviewAndDownload({
  checkboxId,
  zoomBtnId,
  latLng,
  titleLine,
  previewImgUrl,
  downloadUrl,
  downloadLabel,
  downloadName,
  zoomLevel = 18,
  previewWidth = 280,
  dotColour = '#d00'
}) {
  let marker = null;

  const cb = document.getElementById(checkboxId);
  const zoomBtn = document.getElementById(zoomBtnId);

  // 🔒 HARD GUARD — prevents script death
  if (!cb || !zoomBtn) {
    console.warn(`Layer skipped (missing elements):`, checkboxId, zoomBtnId);
    return;
  }

  cb.addEventListener('change', () => {
    if (cb.checked) {
      if (!marker) {
        marker = L.marker(latLng, { icon: makeDotIcon(dotColour) });

        const previewHtml = `
          <div style="width:${previewWidth}px">
            <div style="font-size:12px;margin-bottom:6px">${titleLine}</div>
            <img src="${previewImgUrl}"
                 style="width:100%;height:auto;display:block;border:1px solid #ccc">
          </div>
        `;

        const previewPopup = L.popup({
          closeButton: false,
          autoClose: false,
          closeOnClick: false,
          className: 'article-preview-popup',
          offset: [0, -10]
        }).setContent(previewHtml);

        let pinned = false;
        let closeTimer = null;

        marker.on('mouseover', e => {
          previewPopup.setLatLng(e.latlng).openOn(map);
          setTimeout(() => {
            const el = previewPopup.getElement();
            if (!el) return;
            el.onmouseenter = () => { pinned = true; };
            el.onmouseleave = () => { pinned = false; map.closePopup(previewPopup); };
          }, 0);
        });

        marker.on('mouseout', () => {
          closeTimer = setTimeout(() => {
            if (!pinned) map.closePopup(previewPopup);
          }, 200);
        });

        marker.bindPopup(`
          <div style="width:260px">
            <div style="margin-bottom:8px">Download file?</div>
            <a href="${downloadUrl}" download="${downloadName || ''}"
               style="display:inline-block;padding:6px 10px;border:1px solid #000;text-decoration:none;color:#000">
              ${downloadLabel}
            </a>
          </div>
        `);
      }

      marker.addTo(map);
    } else {
      if (marker) map.removeLayer(marker);
    }
  });

  zoomBtn.addEventListener('click', () => {
    map.setView(latLng, zoomLevel);
  });
}


  
// ---------- Geology etc. overlays ----------
wireOverlayLayer({
  checkboxId: 'layer-geology-hillshade',
  sliderId: 'opacity-geology-hillshade',
  zoomBtnId: 'zoom-geology-hillshade',
  imageUrl: 'data/Geology_etc/NSW_5m_Hillshade.png',
  bounds: [
    [-32.976651, 151.622300], // SW
    [-32.914580, 151.782180]  // NE
  ]
});

wireOverlayLayer({
  checkboxId: 'layer-geology-regional',
  sliderId: 'opacity-geology-regional',
  zoomBtnId: 'zoom-geology-regional',
  imageUrl: 'data/Geology_etc/SimplifiedRegionalGeology.png',
  bounds: [
    [-33.161983, 151.185210], // SW
    [-32.660723, 151.811738]  // NE
  ]
});

// Legend download button
document.getElementById('download-geology-legend').addEventListener('click', () => {
  const a = document.createElement('a');
  a.href = 'data/Geology_etc/SimplifiedGeologyLegend.jpg';
  a.download = 'SimplifiedGeologyLegend.jpg';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
});

// ---------- 1949 markers ----------

wireHoverPreviewAndDownload({
  checkboxId: 'layer-1949-landslide-endangers-flats',
  zoomBtnId: 'zoom-1949-landslide-endangers-flats',
  latLng: [-32.92828, 151.77475],
  titleLine: 'Newspaper article: "Landslide Endangers Flats" (1949)',
  previewImgUrl: 'data/1949/19490621_LandslideEndangersFlats_Image.png',
  downloadUrl: 'data/1949/19490621_LandslideEndangersFlats_Image.png',
  downloadLabel: 'Download PNG',
  downloadName: '1949_Landslide_Endangers_Flats.png',
  zoomLevel: 18
});

wireHoverPreviewAndDownload({
  checkboxId: 'layer-1949-threat-to-boolaroo',
  zoomBtnId: 'zoom-1949-threat-to-boolaroo',
  latLng: [-32.954886, 151.628293],
  titleLine: 'Threat to Boolaroo (2 Sep 1949)',
  previewImgUrl: 'data/1949/19490902_ThreatToBoolaroo.jpg',
  downloadUrl: 'data/1949/19490902_ThreatToBoolaroo.jpg',
  downloadLabel: 'Download JPG',
  downloadName: '1949-09-02_ThreatToBoolaroo.jpg',
  zoomLevel: 18,
  dotColour: '#ffffff'
});

wireHoverPreviewAndDownload({
  checkboxId: 'layer-1949-creep-threat-at-boolaroo',
  zoomBtnId: 'zoom-1949-creep-threat-at-boolaroo',
  latLng: [-32.954437, 151.628161],
  titleLine: '”Creep” Threat At Boolaroo (2 Sep 1949)',
  previewImgUrl: 'data/1949/19490902_CreepThreatAtBoolaroo.jpg',
  downloadUrl: 'data/1949/19490902_CreepThreatAtBoolaroo.pdf',
  downloadLabel: 'Download PDF',
  downloadName: '1949-09-02_Creep-Threat-At-Boolaroo.pdf',
  zoomLevel: 18,
  dotColour: '#ffffff'
});

// ---------- 1950 markers ----------
wireHoverPreviewAndDownload({
  checkboxId: 'layer-1950-this-road-is-bad',
  zoomBtnId: 'zoom-1950-this-road-is-bad',
  latLng: [-32.926352, 151.708845],
  titleLine: '"This Road Is Bad", 21st of April 1950',
  previewImgUrl: 'data/1950/ThisRdIsBad_NewcastleMorningHerald_21Apr1950.jpg',
  downloadUrl: 'data/1950/ThisRdIsBad_NewcastleMorningHerald_21Apr1950.pdf',
  downloadLabel: 'Download PDF',
  downloadName: '1950-04-21_This-Road-Is-Bad.pdf',
  zoomLevel: 18,
  dotColour: '#ffffff'
});

wireHoverPreviewAndDownload({
  checkboxId: 'layer-1950-creep-in-new-lambton-yard',
  zoomBtnId: 'zoom-1950-creep-in-new-lambton-yard',
  latLng: [-32.92608, 151.70847],
  titleLine: '"CREEP" IN NEW LAMBTON YARD, 23/06/1950',
  previewImgUrl: 'data/1950/CreepInNewLambtonYard_NMHandMA_pg2_23Jun1950.jpg',
  downloadUrl: 'data/1950/CreepInNewLambtonYard_NMHandMA_pg2_23Jun1950.jpg',
  downloadLabel: 'Download JPG',
  downloadName: '1950-06-23_CREEP-IN-NEW-LAMBTON-YARD.jpg',
  zoomLevel: 18
});
    
wireHoverPreviewAndDownload({
  checkboxId: 'layer-1950-landslide-at-lake',
  zoomBtnId: 'zoom-1950-landslide-at-lake',
  latLng: [-33.036285, 151.610252],
  titleLine: 'Landslide, Coal Point, 18 Jul 1950',
  previewImgUrl: 'data/1950/19500718_LandslideAtLake.jpg',
  downloadUrl: 'data/1950/19500718_LandslideAtLake.pdf',
  downloadLabel: 'Download PDF',
  downloadName: '1950-07-18_Landslide-At-Lake.pdf',
  zoomLevel: 18
});

wireHoverPreviewAndDownload({
  checkboxId: 'layer-1950-letter-c-g-millington-12thOct',
  zoomBtnId: 'zoom-1950-letter-c-g-millington-12thOct',
  latLng: [-32.92670, 151.71028],
  titleLine: '&nbsp;', // no hover text
  previewImgUrl: 'data/1950/NMHandMA_LetterToTheEditorAddisonRdSlideCGMillington12thOct1950.png',
  downloadUrl: 'data/1950/NMHandMA_LettersToTheEditor12thOct1950.pdf',
  downloadLabel: 'Download PDF',
  downloadName: 'NMHandMA_LettersToTheEditor12thOct1950.pdf',
  zoomLevel: 18,
  dotColour: '#ffffff'
});  

  wireHoverPreviewAndDownload({
  checkboxId: 'layer-1950-letter-isaac-hoare',
  zoomBtnId: 'zoom-1950-letter-isaac-hoare',
  latLng: [-32.925961, 151.710657],
  titleLine: '&nbsp;', // no hover text
  previewImgUrl: 'data/1950/NMHandMA_LetterToTheEditorAddisonRdSlideIsaacHoare14thOct1950.png',
  downloadUrl: 'data/1950/NMHandMA_LettersToTheEditor14thOct1950.pdf',
  downloadLabel: 'Download PDF',
  downloadName: 'NMHandMA_LettersToTheEditor14thOct1950.pdf',
  zoomLevel: 18,
  dotColour: '#ffffff'
});

  
// ---------- 1951 marker ----------
wireHoverPreviewAndDownload({
  checkboxId: 'layer-1951-road-collapses',
  zoomBtnId: 'zoom-1951-road-collapses',
  latLng: [-32.92682, 151.70782],
  titleLine: 'Rainfall figures soaring again – road collapses (17 Jan 1951)',
  previewImgUrl: 'data/1951/19510117_RainfallFiguresSoaringAgain_RoadCollapses.png',
  downloadUrl: 'data/1951/19510117_RainfallFiguresSoaringAgain_RoadCollapses.png',
  downloadLabel: 'Download PNG',
  downloadName: '1951-01-17_RoadCollapses.png',
  zoomLevel: 18
});


// ---------- 2025 marker (single file used for both preview + download) ----------
wireHoverPreviewAndDownload({
  checkboxId: 'layer-LakeMacLocalsFBpost23rdMay2025',
  zoomBtnId: 'zoom-LakeMacLocalsFBpost23rdMay2025',
  latLng: [-32.949896, 151.635760],
  titleLine: 'Rain causes further slip on virgin hill- FaceBook post in “Lake Macquarie Locals”, 23rd May 2025',
  previewImgUrl: 'data/2025/20250523_LakeMacLocalsFBpost.png',
  downloadUrl: 'data/2025/20250523_LakeMacLocalsFBpost.png',
  downloadLabel: 'Download PNG',
  downloadName: '20250523_LakeMacLocalsFBpost_LandslideBoolaroo.png',
  zoomLevel: 18
});

  // 2025 – Satellite imagery, 20th July 2025 (single image overlay)
wireOverlayLayer({
  checkboxId: 'layer-2025-satellite-2025-07-20',
  sliderId: 'opacity-2025-satellite-2025-07-20',
  zoomBtnId: 'zoom-2025-satellite-2025-07-20',
  imageUrl: 'data/2025/MetroMap_Download_Newcastle_2025_4_GM_2025-07-20.jpg',
  bounds: [
    [-32.924481, 151.70692], // SW
    [-32.92230, 151.70998]  // NE
  ]
});


   // Always start with no layers selected on load
document.querySelectorAll('.layers input[type="checkbox"]').forEach(cb => {
  cb.checked = false;
});


});

</script>

<div>
  <p>Phone viewing: Hold your device in landscape orientation.</p>
  <p>Red dots are unique events. White dots are supplementary information to a given event.</p>
  <p>Tip: If a layer or preview isn't loading, give it a few more seconds. Some images are quite large and may take a little while.</p>
  <p>Files >25 MB are currenty not able to be downloaded, sorry. For now you'll have to email me & I'll send it as soon as I can. mathewsmegan@hotmail.com.</p>
</div>
</body>
</html>
